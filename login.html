<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Portal Login</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background: #F3F4F6; margin: 0; }
        .login-card { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); text-align: center; width: 100%; max-width: 400px; }
        h1 { color: #4F46E5; margin-bottom: 10px; }
        p { color: #6B7280; margin-bottom: 30px; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; margin-bottom: 15px; font-size: 16px; }
        button { width: 100%; padding: 12px; background: #4F46E5; color: white; border: none; border-radius: 6px; font-size: 16px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        button:hover { background: #4338ca; }
        button:disabled { background: #a5b4fc; cursor: not-allowed; }
        .error-box { background: #fee2e2; color: #b91c1c; padding: 10px; border-radius: 6px; margin-top: 20px; display: none; font-size: 14px; text-align: left; }
    </style>
</head>
<body>

<div class="login-card">
    <h1>Campaign Portal</h1>
    <p>Sign in to access the request form.</p>
    
    <form id="loginForm">
        <input type="email" id="email" placeholder="Enter your authorized email" required>
        <button type="submit" id="loginBtn">Secure Login</button>
    </form>

    <div class="error-box" id="errorMsg"></div>
</div>

<script>
    // --- UPDATE THIS URL WITH YOUR DEPLOYED SCRIPT URL ---
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby33b18jm2KT-yo5m1PgKBRI0iV_b7fb1ms7D3pdVqsvsSo3vp6RZ8pKhCBUHLlCJA-/exec'; 

    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('email').value.trim();
        if (!email) return;

        const btn = document.getElementById('loginBtn');
        const errBox = document.getElementById('errorMsg');
        
        // Reset UI
        btn.innerText = "Verifying Access...";
        btn.disabled = true;
        errBox.style.display = 'none';

        // STRICT FETCH REQUEST (No "no-cors", No Timeouts)
        // We use 'text/plain' to avoid CORS preflight (OPTIONS) errors on Google Scripts
        fetch(SCRIPT_URL, {
            method: 'POST',
            redirect: "follow", 
            headers: { "Content-Type": "text/plain;charset=utf-8" }, 
            body: JSON.stringify({ action: "login", email: email })
        })
        .then(response => response.json())
        .then(data => {
            if (data.allowed === true) {
                // SUCCESS
                localStorage.setItem('userEmail', email);
                localStorage.setItem('authValid', 'true');
                window.location.href = 'index.html';
            } else {
                // DENIED (Show specific message from sheet)
                throw new Error(data.message || "Access Denied.");
            }
        })
        .catch(error => {
            console.error("Login Error:", error);
            errBox.innerText = "Error: " + (error.message || "Connection failed.");
            errBox.style.display = 'block';
            btn.innerText = "Secure Login";
            btn.disabled = false;
        });
    });
</script>
</body>
</html>
